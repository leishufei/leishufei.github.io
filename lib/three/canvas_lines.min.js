"use strict";THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var R,y,T,w,H,g,S,M,b,C,z,V,j,L,O,B,W,P,k,N=this,F=new THREE.Projector,i=void 0!==e.canvas?e.canvas:document.createElement("canvas"),A=i.width,I=i.height,D=Math.floor(A/2),G=Math.floor(I/2),U=0,q=0,X=A,J=I,n=1,Y=i.getContext("2d",{alpha:!0===e.alpha}),r=new THREE.Color(0),o=!0===e.alpha?0:1,a=1,s=0,l=null,c=null,p=null,E=null,d=null,t=[],K=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),Q=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),Z=new THREE.Color,$=new THREE.Color,_={},ee=new THREE.Box2,te=new THREE.Box2,re=new THREE.Box2,ie=new THREE.Color,ne=new THREE.Color,oe=new THREE.Color,ae=new THREE.Vector3,se=new THREE.Vector3,le=new THREE.Vector3,ce=new THREE.Matrix3;function pe(e,t,r,i){ve(t),xe(r),Re(i),ye(e.getStyle()),Y.stroke(),re.expandByScalar(2*t)}function Ee(e){Te(e.getStyle()),Y.fill()}function de(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:void 0,version:0};var r=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,i=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,n=e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(n?2:1),a.height=t.height*(o?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),1==n&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),1==o&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),1==n&&1==o&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));t="no-repeat";1==r&&1==i?t="repeat":1==r?t="repeat-x":1==i&&(t="repeat-y");t=Y.createPattern(a,t);return e.onUpdate&&e.onUpdate(e),{canvas:t,version:e.version}}function he(e,t,r,i,n,o,a,s,l,c,p,E,d){var h=_[d.id];if(void 0!==h&&h.version===d.version||(h=de(d),_[d.id]=h),void 0===h.canvas)return Te("rgba( 0, 0, 0, 1)"),Y.fill(),0;Te(h.canvas);var f=d.offset.x/d.repeat.x,u=d.offset.y/d.repeat.y,h=d.image.width*d.repeat.x,d=d.image.height*d.repeat.y;l=(l+f)*h,c=(c+u)*d,p=(p+f)*h,E=(E+u)*d,r-=e,i-=t,n-=e,o-=t,0!=(d=(l-=a=(a+f)*h)*(E-=s=(s+u)*d)-(p-=a)*(c-=s))&&(r=e-(d=(E*r-c*n)*(e=1/d))*a-(n=(l*n-p*r)*e)*s,s=t-(c=(E*i-c*o)*e)*a-(e=(l*o-p*i)*e)*s,Y.save(),Y.transform(d,c,n,e,r,s),Y.fill(),Y.restore())}function fe(e,t,r){var i=t.x-e.x,n=t.y-e.y,o=i*i+n*n;0!=o&&(i*=o=r/Math.sqrt(o),n*=o,t.x+=i,t.y+=n,e.x-=i,e.y-=n)}function ue(e){a!==e&&(Y.globalAlpha=e,a=e)}function me(e){s!==e&&(e===THREE.NormalBlending?Y.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?Y.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?Y.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(Y.globalCompositeOperation="multiply"),s=e)}function ve(e){p!==e&&(Y.lineWidth=e,p=e)}function xe(e){E!==e&&(Y.lineCap=e,E=e)}function Re(e){d!==e&&(Y.lineJoin=e,d=e)}function ye(e){l!==e&&(Y.strokeStyle=e,l=e)}function Te(e){c!==e&&(Y.fillStyle=e,c=e)}function we(e){t.length!==e.length&&(Y.setLineDash(e),t=e)}void 0===Y.setLineDash&&(Y.setLineDash=function(){}),this.domElement=i,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.getPixelRatio=function(){return n},this.setPixelRatio=function(e){void 0!==e&&(n=e)},this.setSize=function(e,t,r){A=e*n,I=t*n,i.width=A,i.height=I,D=Math.floor(A/2),G=Math.floor(I/2),!1!==r&&(i.style.width=e+"px",i.style.height=t+"px"),ee.min.set(-D,-G),ee.max.set(D,G),te.min.set(-D,-G),te.max.set(D,G),a=1,s=0,d=E=p=c=l=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){U=e*n,q=t*n,X=r*n,J=i*n},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){r.set(e),o=void 0!==t?t:1,te.min.set(-D,-G),te.max.set(D,G)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return r},this.getClearAlpha=function(){return o},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===te.isEmpty()&&(te.intersect(ee),te.expandByScalar(2),te.min.x=te.min.x+D,te.min.y=-te.min.y+G,te.max.x=te.max.x+D,te.max.y=-te.max.y+G,o<1&&Y.clearRect(0|te.min.x,0|te.max.y,te.max.x-te.min.x|0,te.min.y-te.max.y|0),0<o&&(me(THREE.NormalBlending),ue(1),Te("rgba("+Math.floor(255*r.r)+","+Math.floor(255*r.g)+","+Math.floor(255*r.b)+","+o+")"),Y.fillRect(0|te.min.x,0|te.max.y,te.max.x-te.min.x|0,te.min.y-te.max.y|0)),te.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof THREE.Camera!=0){var r=e.background;r&&r.isColor?(Te("rgb("+Math.floor(255*r.r)+","+Math.floor(255*r.g)+","+Math.floor(255*r.b)+")"),Y.fillRect(0,0,A,I)):!0===this.autoClear&&this.clear(),N.info.render.vertices=0,N.info.render.faces=0,Y.setTransform(X/A,0,0,-J/I,U,I-q),Y.translate(D,G),R=F.projectScene(e,t,this.sortObjects,this.sortElements),y=R.elements,T=R.lights,ce.getNormalMatrix(t.matrixWorldInverse),function(){ie.setRGB(0,0,0),ne.setRGB(0,0,0),oe.setRGB(0,0,0);for(var e=0,t=T.length;e<t;e++){var r=T[e],i=r.color;r instanceof THREE.AmbientLight?ie.add(i):r instanceof THREE.DirectionalLight?ne.add(i):r instanceof THREE.PointLight&&oe.add(i)}}();for(var i=0,n=y.length;i<n;i++){var o=y[i],a=o.material;if(void 0!==a&&0!==a.opacity){if(re.makeEmpty(),o instanceof THREE.RenderableSprite)(w=o).x*=D,w.y*=G,function(e,t,r){ue(r.opacity),me(r.blending);var i,n,o,a,s=t.scale.x*D,l=t.scale.y*G,c=.5*Math.sqrt(s*s+l*l);re.min.set(e.x-c,e.y-c),re.max.set(e.x+c,e.y+c),r instanceof THREE.SpriteMaterial?null!==(a=r.map)?(void 0!==(o=_[a.id])&&o.version===a.version||(o=de(a),_[a.id]=o),void 0!==o.canvas&&(Te(o.canvas),i=(n=a.image).width*a.offset.x,t=n.height*a.offset.y,o=s/(c=n.width*a.repeat.x),a=l/(n=n.height*a.repeat.y),Y.save(),Y.translate(e.x,e.y),0!==r.rotation&&Y.rotate(r.rotation),Y.translate(-s/2,-l/2),Y.scale(o,a),Y.translate(-i,-t),Y.fillRect(i,t,c,n),Y.restore())):(Te(r.color.getStyle()),Y.save(),Y.translate(e.x,e.y),0!==r.rotation&&Y.rotate(r.rotation),Y.scale(s,-l),Y.fillRect(-.5,-.5,1,1),Y.restore()):r instanceof THREE.SpriteCanvasMaterial&&(ye(r.color.getStyle()),Te(r.color.getStyle()),Y.save(),Y.translate(e.x,e.y),0!==r.rotation&&Y.rotate(r.rotation),Y.scale(s,l),r.program(Y),Y.restore())}(w,o,a);else if(o instanceof THREE.RenderableLine)w=o.v1,H=o.v2,w.positionScreen.x*=D,w.positionScreen.y*=G,H.positionScreen.x*=D,H.positionScreen.y*=G,re.setFromPoints([w.positionScreen,H.positionScreen]),!0===ee.intersectsBox(re)&&function(e,t,r,i){if(ue(i.opacity),me(i.blending),Y.beginPath(),Y.moveTo(e.positionScreen.x,e.positionScreen.y),Y.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof THREE.LineBasicMaterial){if(ve(i.linewidth),xe(i.linecap),Re(i.linejoin),i.vertexColors!==THREE.VertexColors)ye(i.color.getStyle());else{var n=r.vertexColors[0].getStyle(),o=r.vertexColors[1].getStyle();if(n===o)ye(n);else{try{var a=Y.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(e){a=n}ye(a)}}Y.stroke(),re.expandByScalar(2*i.linewidth)}else i instanceof THREE.LineDashedMaterial&&(ve(i.linewidth),xe(i.linecap),Re(i.linejoin),ye(i.color.getStyle()),we([i.dashSize,i.gapSize]),Y.stroke(),re.expandByScalar(2*i.linewidth),we([]))}(w,H,o,a);else if(o instanceof THREE.RenderableFace){if(w=o.v1,H=o.v2,g=o.v3,w.positionScreen.z<-1||1<w.positionScreen.z)continue;if(H.positionScreen.z<-1||1<H.positionScreen.z)continue;if(g.positionScreen.z<-1||1<g.positionScreen.z)continue;w.positionScreen.x*=D,w.positionScreen.y*=G,H.positionScreen.x*=D,H.positionScreen.y*=G,g.positionScreen.x*=D,g.positionScreen.y*=G,0<a.overdraw&&(fe(w.positionScreen,H.positionScreen,a.overdraw),fe(H.positionScreen,g.positionScreen,a.overdraw),fe(g.positionScreen,w.positionScreen,a.overdraw)),re.setFromPoints([w.positionScreen,H.positionScreen,g.positionScreen]),!0===ee.intersectsBox(re)&&(s=w,l=H,c=g,E=1,d=2,h=o,f=a,a=o=x=v=m=u=void(p=0),N.info.render.vertices+=3,N.info.render.faces++,ue(f.opacity),me(f.blending),S=s.positionScreen.x,M=s.positionScreen.y,b=l.positionScreen.x,C=l.positionScreen.y,z=c.positionScreen.x,V=c.positionScreen.y,u=S,m=M,v=b,x=C,o=z,a=V,Y.beginPath(),Y.moveTo(u,m),Y.lineTo(v,x),Y.lineTo(o,a),Y.closePath(),(f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial)&&null===f.map?(Q.copy(f.color),Z.copy(f.emissive),f.vertexColors===THREE.FaceColors&&Q.multiply(h.color),K.copy(ie),se.copy(s.positionWorld).add(l.positionWorld).add(c.positionWorld).divideScalar(3),function(e,t,r){for(var i=0,n=T.length;i<n;i++){var o,a,s=T[i];$.copy(s.color),s instanceof THREE.DirectionalLight?(a=ae.setFromMatrixPosition(s.matrixWorld).normalize(),(o=t.dot(a))<=0||(o*=s.intensity,r.add($.multiplyScalar(o)))):s instanceof THREE.PointLight&&(a=ae.setFromMatrixPosition(s.matrixWorld),(o=t.dot(ae.subVectors(a,e).normalize()))<=0||0!=(o*=0==s.distance?1:1-Math.min(e.distanceTo(a)/s.distance,1))&&(o*=s.intensity,r.add($.multiplyScalar(o))))}}(se,h.normalModel,K),K.multiply(Q).add(Z),!0===f.wireframe?pe(K,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Ee(K)):f instanceof THREE.MeshBasicMaterial||f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial?null!==f.map?f.map.mapping===THREE.UVMapping&&(j=h.uvs,he(S,M,b,C,z,V,j[p].x,j[p].y,j[E].x,j[E].y,j[d].x,j[d].y,f.map)):null!==f.envMap?f.envMap.mapping===THREE.SphericalReflectionMapping&&(le.copy(h.vertexNormalsModel[p]).applyMatrix3(ce),L=.5*le.x+.5,O=.5*le.y+.5,le.copy(h.vertexNormalsModel[E]).applyMatrix3(ce),B=.5*le.x+.5,W=.5*le.y+.5,le.copy(h.vertexNormalsModel[d]).applyMatrix3(ce),P=.5*le.x+.5,k=.5*le.y+.5,he(S,M,b,C,z,V,L,O,B,W,P,k,f.envMap)):(K.copy(f.color),f.vertexColors===THREE.FaceColors&&K.multiply(h.color),!0===f.wireframe?pe(K,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Ee(K)):(f instanceof THREE.MeshNormalMaterial?(le.copy(h.normalModel).applyMatrix3(ce),K.setRGB(le.x,le.y,le.z).multiplyScalar(.5).addScalar(.5)):K.setRGB(1,1,1),!0===f.wireframe?pe(K,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Ee(K)))}te.union(re)}}Y.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");var s,l,c,p,E,d,h,f,u,m,v,x}},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var ne,oe,n,ae,se,le,ce,pe,Ee,de,he,fe=[],ue=0,me=[],t=0,r=[],i=0,o=[],a=0,ve=[],xe=0,Re={objects:[],lights:[],elements:[]},ye=new THREE.Vector3,Te=new THREE.Vector4,h=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),f=new THREE.Box3,u=new Array(3),we=(new Array(4),new THREE.Matrix4),He=new THREE.Matrix4,ge=new THREE.Matrix4,Se=new THREE.Matrix3,Me=new THREE.Frustum,be=new THREE.Vector4,Ce=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var ze=new function(){var a=[],s=[],l=null,c=null,p=new THREE.Matrix3;function i(e){var t=e.position,r=e.positionWorld,i=e.positionScreen;r.copy(t).applyMatrix4(he),i.copy(r).applyMatrix4(He);r=1/i.w;i.x*=r,i.y*=r,i.z*=r,e.visible=-1<=i.x&&i.x<=1&&-1<=i.y&&i.y<=1&&-1<=i.z&&i.z<=1}function E(e,t,r){return!0===e.visible||!0===t.visible||!0===r.visible||(u[0]=e.positionScreen,u[1]=t.positionScreen,u[2]=r.positionScreen,h.intersectsBox(f.setFromPoints(u)))}function d(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){c=(l=e).material,p.getNormalMatrix(l.matrixWorld),a.length=0,s.length=0},projectVertex:i,checkTriangleVisibility:E,checkBackfaceCulling:d,pushVertex:function(e,t,r){(n=Ve()).position.set(e,t,r),i(n)},pushNormal:function(e,t,r){a.push(e,t,r)},pushUv:function(e,t){s.push(e,t)},pushLine:function(e,t){e=me[e],t=me[t];(ce=Le()).id=l.id,ce.v1.copy(e),ce.v2.copy(t),ce.z=(e.positionScreen.z+t.positionScreen.z)/2,ce.renderOrder=l.renderOrder,ce.material=l.material,Re.elements.push(ce)},pushTriangle:function(e,t,r){var i=me[e],t=me[t],r=me[r];if(!1!==E(i,t,r)&&(c.side===THREE.DoubleSide||!0===d(i,t,r))){(se=je()).id=l.id,se.v1.copy(i),se.v2.copy(t),se.v3.copy(r),se.z=(i.positionScreen.z+t.positionScreen.z+r.positionScreen.z)/3,se.renderOrder=l.renderOrder,se.normalModel.fromArray(a,3*e),se.normalModel.applyMatrix3(p).normalize();for(var n=0;n<3;n++){var o=se.vertexNormalsModel[n];o.fromArray(a,3*arguments[n]),o.applyMatrix3(p).normalize(),se.uvs[n].fromArray(s,2*arguments[n])}se.vertexNormalsLength=3,se.material=l.material,Re.elements.push(se)}}}};function Ve(){if(ae!==t)return me[ae++];var e=new THREE.RenderableVertex;return me.push(e),t++,ae++,e}function je(){if(le!==i)return r[le++];var e=new THREE.RenderableFace;return r.push(e),i++,le++,e}function Le(){if(pe!==a)return o[pe++];var e=new THREE.RenderableLine;return o.push(e),a++,pe++,e}function Oe(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,t,r,i){function n(e){(ne=function(){if(oe!==ue)return fe[oe++];var e=new THREE.RenderableObject;return fe.push(e),ue++,oe++,e}()).id=e.id,ne.object=e,ye.setFromMatrixPosition(e.matrixWorld),ye.applyMatrix4(He),ne.z=ye.z,ne.renderOrder=e.renderOrder,Re.objects.push(ne)}de=pe=le=0,!(Re.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),we.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),He.multiplyMatrices(t.projectionMatrix,we),Me.setFromMatrix(He),oe=0,Re.objects.length=0,Re.lights.length=0,e.traverseVisible(function(e){if(e instanceof THREE.Light)Re.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===Me.intersectsObject(e))return;n(e)}else if(e instanceof THREE.Sprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===Me.intersectsSprite(e))return;n(e)}}),!0===r&&Re.objects.sort(Oe);for(var o,a,s,l,c,p,E,d,h=0,f=Re.objects.length;h<f;h++){var u,m,v=Re.objects[h].object,x=v.geometry;if(ze.setObject(v),he=v.matrixWorld,ae=0,v instanceof THREE.Mesh){if(x instanceof THREE.BufferGeometry){var R=x.attributes,y=x.groups;if(void 0!==R.position){for(var T=0,w=(u=R.position.array).length;T<w;T+=3)ze.pushVertex(u[T],u[T+1],u[T+2]);if(void 0!==R.normal)for(var H=R.normal.array,T=0,w=H.length;T<w;T+=3)ze.pushNormal(H[T],H[T+1],H[T+2]);if(void 0!==R.uv){var g=R.uv.array;for(T=0,w=g.length;T<w;T+=2)ze.pushUv(g[T],g[T+1])}if(null!==x.index){var S=x.index.array;if(0<y.length)for(var M=0;M<y.length;M++){var b=y[M];for(T=b.start,w=b.start+b.count;T<w;T+=3)ze.pushTriangle(S[T],S[T+1],S[T+2])}else for(T=0,w=S.length;T<w;T+=3)ze.pushTriangle(S[T],S[T+1],S[T+2])}else for(T=0,w=u.length/3;T<w;T+=3)ze.pushTriangle(T,T+1,T+2)}}else if(x instanceof THREE.Geometry){var C=x.vertices,z=x.faces,V=x.faceVertexUvs[0];Se.getNormalMatrix(he);for(var j=v.material,L=j instanceof THREE.MultiMaterial,O=1==L?v.material:null,B=0,W=C.length;B<W;B++){var P=C[B];if(ye.copy(P),!0===j.morphTargets)for(var k=x.morphTargets,N=v.morphTargetInfluences,F=0,A=k.length;F<A;F++){var I,D=N[F];0!==D&&(I=k[F].vertices[B],ye.x+=(I.x-P.x)*D,ye.y+=(I.y-P.y)*D,ye.z+=(I.z-P.z)*D)}ze.pushVertex(ye.x,ye.y,ye.z)}for(var G=0,U=z.length;G<U;G++){var q=z[G];if(void 0!==(j=1==L?O.materials[q.materialIndex]:v.material)){var X=j.side,J=me[q.a],Y=me[q.b],K=me[q.c];if(!1!==ze.checkTriangleVisibility(J,Y,K)){var Q=ze.checkBackfaceCulling(J,Y,K);if(X!==THREE.DoubleSide){if(X===THREE.FrontSide&&!1===Q)continue;if(X===THREE.BackSide&&!0===Q)continue}(se=je()).id=v.id,se.v1.copy(J),se.v2.copy(Y),se.v3.copy(K),se.normalModel.copy(q.normal),!1!==Q||X!==THREE.BackSide&&X!==THREE.DoubleSide||se.normalModel.negate(),se.normalModel.applyMatrix3(Se).normalize();for(var Z=q.vertexNormals,$=0,_=Math.min(Z.length,3);$<_;$++){var ee=se.vertexNormalsModel[$];ee.copy(Z[$]),!1!==Q||X!==THREE.BackSide&&X!==THREE.DoubleSide||ee.negate(),ee.applyMatrix3(Se).normalize()}se.vertexNormalsLength=Z.length;var te=V[G];if(void 0!==te)for(var re=0;re<3;re++)se.uvs[re].copy(te[re]);se.color=q.color,se.material=j,se.z=(J.positionScreen.z+Y.positionScreen.z+K.positionScreen.z)/3,se.renderOrder=v.renderOrder,Re.elements.push(se)}}}}}else if(v instanceof THREE.Line){if(x instanceof THREE.BufferGeometry){if(void 0!==(R=x.attributes).position){for(T=0,w=(u=R.position.array).length;T<w;T+=3)ze.pushVertex(u[T],u[T+1],u[T+2]);if(null!==x.index)for(T=0,w=(S=x.index.array).length;T<w;T+=2)ze.pushLine(S[T],S[T+1]);else{var ie=v instanceof THREE.LineSegments?2:1;for(T=0,w=u.length/3-1;T<w;T+=ie)ze.pushLine(T,T+1)}}}else if(x instanceof THREE.Geometry&&(ge.multiplyMatrices(He,he),0!==(C=v.geometry.vertices).length))for((J=Ve()).positionScreen.copy(C[0]).applyMatrix4(ge),ie=v instanceof THREE.LineSegments?2:1,B=1,W=C.length;B<W;B++)(J=Ve()).positionScreen.copy(C[B]).applyMatrix4(ge),0<(B+1)%ie||(Y=me[ae-2],be.copy(J.positionScreen),Ce.copy(Y.positionScreen),!0==(a=Ce,d=E=p=c=l=s=void 0,s=0,l=1,c=(o=be).z+o.w,p=a.z+a.w,E=-o.z+o.w,d=-a.z+a.w,0<=c&&0<=p&&0<=E&&0<=d||!(c<0&&p<0||E<0&&d<0)&&(c<0?s=Math.max(s,c/(c-p)):p<0&&(l=Math.min(l,c/(c-p))),E<0?s=Math.max(s,E/(E-d)):d<0&&(l=Math.min(l,E/(E-d))),!(l<s||(o.lerp(a,s),a.lerp(o,1-l),0))))&&(be.multiplyScalar(1/be.w),Ce.multiplyScalar(1/Ce.w),(ce=Le()).id=v.id,ce.v1.positionScreen.copy(be),ce.v2.positionScreen.copy(Ce),ce.z=Math.max(be.z,Ce.z),ce.renderOrder=v.renderOrder,ce.material=v.material,v.material.vertexColors===THREE.VertexColors&&(ce.vertexColors[0].copy(v.geometry.colors[B]),ce.vertexColors[1].copy(v.geometry.colors[B-1])),Re.elements.push(ce)))}else{v instanceof THREE.Sprite&&(Te.set(he.elements[12],he.elements[13],he.elements[14],1),Te.applyMatrix4(He),m=1/Te.w,Te.z*=m,-1<=Te.z&&Te.z<=1&&((Ee=function(){if(de!==xe)return ve[de++];var e=new THREE.RenderableSprite;return ve.push(e),xe++,de++,e}()).id=v.id,Ee.x=Te.x*m,Ee.y=Te.y*m,Ee.z=Te.z,Ee.renderOrder=v.renderOrder,Ee.object=v,Ee.rotation=v.rotation,Ee.scale.x=v.scale.x*Math.abs(Ee.x-(Te.x+t.projectionMatrix.elements[0])/(Te.w+t.projectionMatrix.elements[12])),Ee.scale.y=v.scale.y*Math.abs(Ee.y-(Te.y+t.projectionMatrix.elements[5])/(Te.w+t.projectionMatrix.elements[13])),Ee.material=v.material,Re.elements.push(Ee)))}}return!0===i&&Re.elements.sort(Oe),Re}},function(){var a,s,l,t=0,r=0,i=window.innerWidth/2,n=window.innerHeight/2;function c(){i=window.innerWidth/2,n=window.innerHeight/2,a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),l.setSize(window.innerWidth,window.innerHeight)}function p(e){t=e.clientX-i,r=e.clientY-n}function E(e){1<e.touches.length&&(t=e.touches[0].pageX-i)}function d(e){1==e.touches.length&&(t=e.touches[0].pageX-i)}!function(){var e;(o=document.createElement("div")).style.position="fixed",o.style.top="0px",o.style.left="0px",o.style.zIndex="-1",o.style.opacity="0.5",document.body.appendChild(o),(a=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e4)).position.z=100,s=new THREE.Scene,(l=new THREE.CanvasRenderer({alpha:!0})).setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight),o.appendChild(l.domElement);for(var t=2*Math.PI,r=new THREE.SpriteCanvasMaterial({color:10263708,program:function(e){e.beginPath(),e.arc(0,0,.5,0,t,!0),e.fill()}}),i=new THREE.Geometry,n=0;n<100;n++)(e=new THREE.Sprite(r)).position.x=2*Math.random()-1,e.position.y=2*Math.random()-1,e.position.z=2*Math.random()-1,e.position.normalize(),e.position.multiplyScalar(10*Math.random()+450),e.scale.x=e.scale.y=10,s.add(e),i.vertices.push(e.position);var o=new THREE.Line(i,new THREE.LineBasicMaterial({color:10263708,opacity:.5}));s.add(o),document.addEventListener("mousemove",p,!1),document.addEventListener("touchstart",E,!1),document.addEventListener("touchmove",d,!1),window.addEventListener("resize",c,!1)}(),function e(){requestAnimationFrame(e),a.position.x+=.05*(t-a.position.x),a.position.y+=.05*(200-r-a.position.y),a.lookAt(s.position),l.render(s,a)}()}();